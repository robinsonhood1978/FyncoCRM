<#macro layout>
<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Fynco CRM</title>

    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <!-- Simplebar -->
    <link type="text/css" href="/t/assets/vendor/simplebar.min.css" rel="stylesheet">

    <!-- App CSS -->
    <link type="text/css" href="/t/assets/css/app.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/app.rtl.css" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="/t/assets/css/vendor-material-icons.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-material-icons.rtl.css" rel="stylesheet">

    <!-- Font Awesome FREE Icons -->
    <link type="text/css" href="/t/assets/css/vendor-fontawesome-free.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-fontawesome-free.rtl.css" rel="stylesheet">

    <!-- FullCalendar -->
    <link type="text/css" href="/t/assets/vendor/fullcalendar/fullcalendar.min.css" rel="stylesheet">
    <!-- Flatpickr -->
    <link type="text/css" href="/t/assets/css/vendor-flatpickr.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-flatpickr.rtl.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-flatpickr-airbnb.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-flatpickr-airbnb.rtl.css" rel="stylesheet">
    
    <!-- Select2 -->
    <link type="text/css" href="/t/assets/css/vendor-select2.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/css/vendor-select2.rtl.css" rel="stylesheet">
    <link type="text/css" href="/t/assets/vendor/select2/select2.min.css" rel="stylesheet">
  
  <style type="text/css">  
  .embed-responsive, .embed-responsive iframe, .embed-responsive-1by1, .embed-responsive-item { max-width: 100%; max-height:260px; }
  	.comment {  
	 width:100%;
	 overflow:auto;  
	 word-break:break-all;  
	}  
	
  </style>  
	<!-- jQuery -->
    <script src="/t/assets/vendor/jquery.min.js"></script>
    <script type="text/javascript" src="/js/pony.js"></script>
    <script src="/js/jquery.maskMoney.js" type="text/javascript"></script>

    <!-- Bootstrap -->
    <script src="/t/assets/vendor/popper.min.js"></script>
    <script src="/t/assets/vendor/bootstrap.min.js"></script>
    <!-- jQuery UI (for draggable) -->
    
    <!-- Fynco -->
    <script src="/f/assets/js/md5.min.js"></script>
	<script src="/f/assets/js/base64.min.js"></script>
	<script src="/f/assets/js/mobile/layer.js"></script>
	<script src="/f/assets/js/js.cookie.min.js"></script>
	<script src="/f/assets/js/fynco.js"></script>
	<script src="/f/assets/js/moment.js"></script>
	<link rel="stylesheet" type="text/css" href="/css/webuploader.css">
<link rel="stylesheet" type="text/css" href="/css/diyUpload.css">
<script type="text/javascript" src="/js/webuploader.html5only.min.js"></script>
	<script type="text/javascript" src="/js/diyUpload.js"></script>
	
</head>

<body class="layout-default">


    <div class="preloader"></div>

    <!-- Header Layout -->
    <div class="mdk-header-layout js-mdk-header-layout">

        <!-- Header Layout Content -->
        <div class="mdk-header-layout__content">

            <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
                <#nested>
                <div class="mdk-drawer  js-mdk-drawer" id="default-drawer" data-align="start">
                    <div class="mdk-drawer__content">
                        <div class="sidebar sidebar-light sidebar-left simplebar" data-simplebar>
                            <div>
                            <div style="display:inline-block" class="sidebar-heading sidebar-m-t">Uploaded Files</div>
                            <div style="display:inline-block;float:right"><a href="javascript:void(0)" onclick="ShowEditDiv();" class="btn btn-primary">Edit</a></div>
                            </div>
                            <div style="display:none" id="EditDiv">
                            <a href="javascript:void(0)" onclick="DeleteDoc();" class="btn btn-success ml-3">Delete</a>
                            <a href="javascript:void(0)" onclick="RenameDoc();" class="btn btn-success ml-3">Rename</a>
                            <a href="javascript:void(0)" onclick="ClassDoc();" class="btn btn-success ml-3">Classification</a>
                            </div>
                            <div id="menus">
                                                <div style="display:none;" id="menu">
	                                                <div id="menu_[kid]">
		                                                   <div class="row">  
					                                       		<div class="col">
						                                            <div class="form-group">
						                                                <select style="width:100%" id="[kid]" name="classy">
																			<option value="Application Form">Application Form</option>
																			<option value="Approval Letter">Approval Letter</option>
																			<option value="Appraisal">Appraisal</option>
																			<option value="Gifting Letter">Gifting Letter</option>
																			<option value="Proof of Identity">Proof of Identity</option>
																			<option value="Rate Lock Form">Rate Lock Form</option>
																			<option value="Sales Purchase Agreement">Sales Purchase Agreement</option>
																			<option value="IRD Summary">IRD Summary</option>
																		</select>
						                                            </div>
						                                     	</div>
					                                       </div>
	                                                </div>
                                                </div>
                                                
                                                
                                                <div style="display:none;" id="pdf_file">
                                                
                                                   <div class="row">  
			                                       		<div class="col">
				                                            <div class="form-group">
				                                            <input style="display:none;" type="checkbox" name="diySelect" value="[attid]">
				                                            <i class="sidebar-menu-icon sidebar-menu-icon--left material-icons">picture_as_pdf</i>
				                                            [pdf_file]
				                                            </div>
				                                     	</div>
			                                       </div>
                                              
                                                </div>
                                                
                             </div>   
                            

                            

                        </div>
                    </div>
                </div>
            </div>
            <!-- // END drawer-layout -->

        </div>
        <!-- // END header-layout__content -->

    </div>
    <!-- // END header-layout -->



    

    <!-- Simplebar -->
    <script src="/t/assets/vendor/simplebar.min.js"></script>

    <!-- DOM Factory -->
    <script src="/t/assets/vendor/dom-factory.js"></script>

    <!-- MDK -->
    <script src="/t/assets/vendor/material-design-kit.js"></script>

    <!-- App -->
    <script src="/t/assets/js/toggle-check-all.js"></script>
    <script src="/t/assets/js/check-selected-row.js"></script>
    <script src="/t/assets/js/dropdown.js"></script>
    <script src="/t/assets/js/sidebar-mini.js"></script>
    <script src="/t/assets/js/app.js"></script>

    <!-- App Settings (safe to remove) -->
    <script src="/t/assets/js/app-settings.js"></script>
	
    <!-- jQuery Mask Plugin -->
    <script src="/t/assets/vendor/jquery.mask.min.js"></script>
    <script src="/t/assets/vendor/jquery-ui.min.js"></script>

    <!-- Moment.js -->
    <script src="/t/assets/vendor/moment.min.js"></script>

    <!-- FullCalendar -->
    <script src="/t/assets/vendor/fullcalendar/fullcalendar.min.js"></script>
    <script src="/t/assets/js/fullcalendar.js"></script>
	<!-- Flatpickr -->
    <script src="/t/assets/vendor/flatpickr/flatpickr.min.js"></script>
    <script src="/t/assets/js/flatpickr.js"></script>
    <!-- Select2 -->
    <script src="/t/assets/vendor/select2/select2.min.js"></script>
    <script src="/t/assets/js/select2.js"></script>
    
    <script src="/f/assets/js/layer.js"></script>
<script src="/f/assets/js/mobile/mlayer.js"></script>
<script>
function ClassDoc(){
	var b = [];
    $("input:checkbox[name = 'diySelect']:checked").each(function(i){ 
        b.push( $(this).val() ); 
    });
	var val = String(b);
	if(b.length==0||b.length>1){
    	mlayer.open({
		    content: 'Please select one file at first!',
		    btn: 'Got it'
		  });
        return false;
    }
    else{
    	var url = '/application/classy/?attid='+val;
    	layer.open({
    		type: 2,
    		title: 'Modify Classification of Document',
    		fixed: false, //不固定
    		maxmin: true,
    	    shadeClose: true, //点击遮罩关闭层
    		area: ['80%', '80%'],
    		content: url ,
    		success:function(layero,index){
            },
            end:function(){
    			//alert(1)
            }
    	}); 
    }
	
}
function RenameDoc(){
	var b = [];
    $("input:checkbox[name = 'diySelect']:checked").each(function(i){ 
        b.push( $(this).val() ); 
    });
	var val = String(b);
	if(b.length==0||b.length>1){
    	mlayer.open({
		    content: 'Please select one file at first!',
		    btn: 'Got it'
		});
        return false;
    }
    else{
    	var url = '/application/rename/?attid='+val;
    	layer.open({
    		type: 2,
    		title: 'Rename Document',
    		fixed: false, //不固定
    		maxmin: true,
    	    shadeClose: true, //点击遮罩关闭层
    		area: ['80%', '80%'],
    		content: url ,
    		success:function(layero,index){
            },
            end:function(){
    			//alert(1)
            }
    	}); 
    }
	
}
function DeleteDoc(){
	var appid = $('#appid').val();
	var b = [];
        $("input:checkbox[name = 'diySelect']:checked").each(function(i){ 
            //使用循环遍历迭代的方式得到所有被选中的checkbox复选框
            b.push( $(this).val() ); //当前被选中checkbox背后对应的值
        });
	var val = String(b);
    if(b.length==0){
    	mlayer.open({
		    content: 'Please select one file at first!',
		    btn: 'Got it'
		    
		  });
        return false;
    }
    else{
    	mlayer.open({
    	    content: 'It cannot be recovered after deletion. Do you really want to delete this file?'
    	    ,btn: ['Yes', 'Cancel']
    	    ,yes: function(index){
    	    	$.post("/application/deldoc", {"appid":appid,"id":val}, function(data) {
					if(data.code==0){
						mlayer.open({
						    content: 'Success',
						    btn: 'Got it',
						    yes: function(){
						    	window.location.reload(); 
						    	
						      }
						  });
					}
					return false;
				}, "json");   
    	        mlayer.close(index);
    	    }
    	    ,no:function(index){
    	    	mlayer.close(index);
    	    }
    	  }); 
    }
	
}
var switching = false;
function ShowEditDiv(){
	if(!switching){
		$('#EditDiv').show();
		$('input[type="checkbox"]').show();
		switching = true;
	}
	else{
		$('#EditDiv').hide();
		$('input[type="checkbox"]').hide();
		switching = false;
	}
}
String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.split(search).join(replacement);
};
function parseDom(arg) {

	var objE = document.createElement("div");

	objE.innerHTML = '<div>'+arg+'</div>';

	return objE.childNodes;

}
function copyNode(nodeid,key){
	var sourceNode = document.getElementById(nodeid); // 获得被克隆的节点对象 
	var clonedNode = sourceNode.cloneNode(true); // 克隆节点 
	
	$node = $(clonedNode);
	//$node.find('select[name="classy"]').val(key);
	var nbk = key.replace(/\s+/g,"");
	var html = $node.html().replaceAll('[kid]',nbk);  
	//console.log(html)
	var newnode = parseDom(html);
	sourceNode.parentNode.appendChild($(newnode)[0]); // 在父节点插入克隆的节点 
}
function copyLeaf(nodeid,key,filename,attid){
	var sourceNode = document.getElementById(nodeid); // 获得被克隆的节点对象 
	var clonedNode = sourceNode.cloneNode(true); // 克隆节点 
	
	$node = $(clonedNode);
	//$node.find('select[name="classy"]').val(key);
	var html = $node.html().replaceAll('[pdf_file]',filename).replaceAll('[attid]',attid);  
	//console.log(html)
	var newnode = parseDom(html);
	var parentClass = document.getElementById("menu_"+nbk); 
	parentClass.appendChild($(newnode)[0]); // 在父节点插入克隆的节点 
}
var doc = '${(application.documents)!}';
var documents = jsonToStrMap(doc);
for (var [key] of documents) {
	  copyNode("menu",key);
}
var classy = document.getElementsByName("classy");
for (var [ky,value] of documents) {
	var nbk = ky.replace(/\s+/g,"");
	$('#'+nbk).val(ky);
	$('#'+nbk).attr("disabled", "disabled"); 
	for(var i=0;i<value.length;i++){
		var vlObj = value[i];
		var filename = vlObj.filename;
		var attid = vlObj.attid;
		copyLeaf("pdf_file",ky,filename,attid);
	}
}
</script>
</body>

</html>
</#macro>