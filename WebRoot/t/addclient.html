<#include "/t/${layout}" />
<@layout>
                <div class="mdk-drawer-layout__content page">

<#if ilay==0>

                    <div class="container-fluid  page__heading-container">
                        <div class="page__heading d-flex align-items-center">
                        	<div class="flex">
	                            <nav aria-label="breadcrumb">
	                                <ol class="breadcrumb mb-0">
	                                    <li class="breadcrumb-item"><a href="#"><i class="material-icons icon-20pt">home</i></a></li>
	                                    <li class="breadcrumb-item">Clients</li>
	                                    <li class="breadcrumb-item active" aria-current="page">Clients</li>
	                                </ol>
	                            </nav>
                            <h1 class="m-0"><#if method=='add'>New<#else>Edit</#if> Client</h1>
                            </div>
                            <button class="btn btn-success" onClick="return SaveClient('${method}');">Save Client</button>
                            	&nbsp;	
                            <button onclick="history.go(-1)" class="btn btn-success">Go Back</button>
                        </div>
                    </div>

</#if>

                    <div class="container-fluid page__container">
                        <div class="card card-form">
                        <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px; background-color: #C0C0C0;">
                                    <p><strong class="headings-color">General Information</strong></p>
                                    <!-- <p class="text-muted">Edit the client general information.</p> -->
                                    <!-- <#if type!=2>
                                    <div class="embed-responsive embed-responsive-1by1">
									  <iframe id="iframe_avatar" class="embed-responsive-item" src="/add_avatar2?url=${(client.avatar)!}" allowfullscreen></iframe>
									</div>  
									<div class="row">
									<div class="col">
									<div style="text-align:center;" class="form-group">
									<button id="edit_avatar" type="button" class="btn btn-primary btn-rounded">Edit Avatar</button>
									</div>
									</div>
									</div>
									</#if> -->
                                </div>
                            <div class="row no-gutters">
                                
                                <div class="col-lg-12 card-form__body card-body">
                                	<div class="row">
                                    	<div class="col">
                                            <div class="form-group">
                                                <label for="lname">Title</label>
                                                <!-- <input type="text" class="form-control" name="client.title" id="title" value="${(client.title)!}"> -->
                                                <select id="title" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
		                                            <option value="Mr" >
		                                                Mr
		                                            </option>
		                                            <option value="Miss" >
		                                                Miss
		                                            </option>
		                                            <option value="Mrs" >
		                                                Mrs
		                                            </option>
		                                            <option value="Ms" >
		                                                Ms
		                                            </option>
		                                        </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Gender</label>
                                                <select id="gender" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
		                                            <option value="1" data-avatar-src="/t/assets/images/avatar/male.jpg">
		                                                Male
		                                            </option>
		                                            <option value="0" data-avatar-src="/t/assets/images/avatar/female.jpg">
		                                                Female
		                                            </option>
		                                            <option value="2" data-avatar-src="/t/assets/images/avatar/dfavatar.png">
		                                                Unknown
		                                            </option>
		                                        </select>
                                            </div>
                                        </div>
                                    </div>
                                 	<div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">First name</label>
                                                <input type="text" class="form-control" name="client.first_name" id="first_name" value="${(client.first_name)!}">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Last name</label>
                                                <input type="text" class="form-control" name="client.last_name" id="last_name" value="${(client.last_name)!}">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                    	<div class="col">
                                            <div class="form-group">
                                                <label for="fname">Preferred Name</label>
                                                <input type="text" class="form-control" name="client.prefered_name" id="prefered_name" value="${(client.prefered_name)!}" >
                                            </div>
                                        </div>
                                        <div class="col">
                                             <div class="form-group">
		                                        <label for="birthday">Date of Birth</label>
		                                        <input id="birthday" type="date" class="form-control" value="<#if client??&&client.birthday??>${(client.birthday)?string('yyyy-MM-dd')!}</#if>" placeholder="date: 00/00/0000"  maxlength="10">
		                                    </div>
                                        </div>
                                    </div>
                                   <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Personal Email</label>&nbsp;&nbsp;&nbsp;&nbsp;<i id="add_email" class="material-icons">add_circle_outline</i>
                                                 <div id="emails">
                                                	<div id="inputemail">
                                                	<div id="divemail" class="search-form search-form--light">
                                                <input type="text" class="form-control" name="email">
                                                <button onclick="RemoveEmail('[email_index]')" id="bt_email" style="display:none;" class="btn" type="button" role="button"><i class="material-icons">close</i></button>
                                            </div>
                                                		
                                            		</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Work Email</label>
                                                <input type="text" class="form-control" name="client.work_email" id="work_email" value="${(client.work_email)!}">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Mobile</label>&nbsp;&nbsp;&nbsp;&nbsp;
                                                <i id="add_mobile" class="material-icons">add_circle_outline</i>
                                                <div id="mobiles">
                                                	<div id="inputmobile">
                                                	<div id="divmobile" class="search-form search-form--light">
                                                <input class="form-control" type="tel" name="mobile" pattern="[0-9]*" value="">
                                                <button onclick="RemoveMobile('[mobile_index]')" id="bt_mobile" style="display:none;" class="btn" type="button" role="button"><i class="material-icons">close</i></button>
                                            </div>
                                            
	                                                	
	                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Work Phone</label>
                                                <input type="text" class="form-control" name="client.work_phone" id="work_phone" value="${(client.work_phone)!}">
                                            </div>
                                        </div>
                                    </div>
                                   
                                    <div class="row">
                                        
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Home Phone</label>
                                                <input type="text" class="form-control" name="client.home_phone" id="home_phone" value="${(client.home_phone)!}">
                                            </div>
                                        </div>
                                        <div class="col">
                                       		<div class="form-group">
                                                <label for="lname">Wechat</label>
                                                <input type="text" class="form-control" name="client.wechat" id="wechat" value="${(client.wechat)!}">
                                            </div>
 
                                        </div>
                                    </div>
                                    <!-- dannel Modify Start-->
                                    <#if type!=2>
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">New Zealand Residency</label>
                                                <select id="residency_nz" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
                                            <option value="1">
                                                Permanent Resident
                                            </option>
                                            <option value="2">
                                                New Zealand Citizenship
                                            </option>
                                            <option value="0">
                                                None
                                            </option>
                                        </select>
                                                  </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Marital Status</label>
                                                <select id="marital_status" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
                                            <option value="0">
                                                Married
                                            </option>
                                            <option value="1">
                                                Single
                                            </option>
                                            <option value="2">
                                                De Facto
                                            </option>
                                            <option value="3">
                                                Other
                                            </option>
                                        </select>
                                           </div>
                                        </div>
                                    </div>
                                   
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Address</label>&nbsp;&nbsp;&nbsp;&nbsp;
                                                <i id="add_address" class="material-icons">add_circle_outline</i>
                                                <div id="addresses">
                                                	<div id="inputaddress">
                                                	<div id="divaddress" class="search-form search-form--light">
                                                <input type="text" class="form-control" name="address">
                                                <button onclick="RemoveAddress('[address_index]')" id="bt_address" style="display:none;" class="btn" type="button" role="button"><i class="material-icons">close</i></button>
                                                </div>
                                            
	                                                	
	                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    </#if>
                                    <!-- dannel Modify End-->
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Comments</label><br/>
                                                <textarea class="comment" id="comments" name="client.comments" rows="3" cols="60">${(client.comments)!}</textarea>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
						<!-- dannel Modify Start-->
						<#if type==2>
 						<div class="card card-form">
 						 <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px;background-color: #C0C0C0;">
                                    <p><strong class="headings-color">Main Information</strong></p>
                                    <!-- <p class="text-muted">Edit the client detailed information.</p> -->
                                </div>
                            <div class="row no-gutters">
                               
                                <div class="col-lg-12 card-form__body card-body">
                                 	<div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">No. of Dependants</label>
                                                <input type="text" class="form-control" name="client.dependants_number" id="dependants_number" value="${(client.dependants_number)!}">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                            	<div>
                                            		<label>Age of Dependants</label>
                                            	</div>
                                                
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
	                                                <input type="text" maxlength=2 style="width:9.3%;height:30px;display:inline;" name="dependants_age"/>
                                                      
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">New Zealand Residency</label>
                                                <select id="residency_nz" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
                                            <option value="1">
                                                Permanent Resident
                                            </option>
                                            <option value="2">
                                                New Zealand Citizenship
                                            </option>
                                            <option value="0">
                                                None
                                            </option>
                                        </select>
                                                  </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Marital Status</label>
                                                <select id="marital_status" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
                                            <option value="0">
                                                Married
                                            </option>
                                            <option value="1">
                                                Single
                                            </option>
                                            <option value="2">
                                                De Facto
                                            </option>
                                            <option value="3">
                                                Other
                                            </option>
                                        </select>
                                           </div>
                                        </div>
                                    </div>
                                   
                                    <div class="row">
	                                    <div style="padding-left:16px; width: 70%">
	                                    	<label for="fname">Current Residential Address (Address client are currently residing)</label>
	                                    </div>
	                                    <div style="width: 30%; padding-left: 16px;">
	                                     	<label for="fname">Period Styled(Years, Months)</label>
	                                    </div>
                                        <!-- <div class="col" colspan="5">
                                            <div class="form-group">
                                                <label for="fname">Current Residential Address (Address client are currently residing)</label>
                                            </div>
                                        </div>
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Period Styled</label>
                                                
                                            </div>
                                        </div>
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Period Styled</label>
                                                
                                            </div>
                                        </div>
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Period Styled</label>
                                                
                                            </div>
                                        </div>
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Period Styled</label>
                                                
                                            </div>
                                        </div>
                                        
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Current Residential Address (Address client are currently residing)</label>
                                                <input class="form-control" type="text" id="current_residential_address" value="${(client.current_residential_address)!}">
                                            </div>
                                        </div>
                                        <div class="col" >
                                            <div class="form-group">
                                                <label for="fname">Period Styled</label>
                                                
                                            </div>
                                        </div> -->
                                        
                                        
                                    </div>
                                    <div class="row">
                                    	<div style="padding-left: 16px;padding-right: 8px; width: 70%">
	                                    	<input class="form-control" type="text" id="current_residential_address" value="${(client.current_residential_address)!}">
	                                    </div>
	                                    <div style="width: 15%; padding-left: 2px;padding-right: 8px;">
	                                     	<input type="text" class="form-control" id="time_stayed_years" value="${(client.time_stayed_years)!}">
	                                    </div>
	                                    <div style="width: 15%; padding-left: 2px;padding-right: 16px;">
	                                     	<input type="text" class="form-control" id="time_stayed_months" value="${(client.time_stayed_months)!}">
	                                    </div>

	                                    
                                        <!-- <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Time Stayed:</label>
                                                <div class="row">
	                                                <div class="col">
			                                            <div class="form-group">
			                                                <label>Year(s)</label>
			                                                <input type="text" class="form-control" id="time_stayed_years" value="${(client.time_stayed_years)!}">
			                                            </div>
				                                     </div>
			                                        <div class="col">
			                                            <div class="form-group">
			                                                <label>Month(s)</label>
			                                                <input type="text" class="form-control" id="time_stayed_months" value="${(client.time_stayed_months)!}">
			                                            </div>
			                                        </div>
                                                </div>
                                             </div>
                                        </div> -->
                                    </div>
                                    <!-- <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Previous Residential Address (If client have stayed at current address for less than 3 years)</label>
                                                <input class="form-control" type="text" id="previous_residential_address" value="${(client.previous_residential_address)!}">
                                            </div>
                                        </div>
                                        
                                    </div> -->
                                    <!-- dannel Modify Start-->
                                    <br>
                                    <label for="fname">Previous Residential Address (If client have stayed at current address for less than 3 years)</label>
                                     <div id="preaddresses">
                                                	<div id="inputpreaddress">
                                                	<div id="divpreaddress">
                                                	
                                                	<div class="row">
		                                    <div class="col">
		                                            <div class="card-header bg-white d-flex align-items-center" style="padding-bottom: 1px;">
						                               <p><strong class="headings-color">Previous Residential Address</strong></p>
						                                <div class="d-flex ml-auto">
						                                    <div style="display:none" onclick="RemovePreAddress('[pre_address_index]')" id="bt_pre_address">
						                                                <i class="material-icons">remove_circle_outline</i>
						                                           		<label>Remove</label>
						                                           		</div>
						                                </div>
						                            </div>
				                                    </div>
				                                    </div>
                                    <div class="row">
                                    	<div style="padding-left:16px; width: 70%">
	                                    	<label for="fname">Previous Residential Address</label>
	                                    </div>
	                                    <div style="width: 30%; padding-left: 16px;">
	                                     	<label for="fname">Period Styled(Year(s), Month(s))</label>
	                                    </div>
                                        <!-- <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Previous Residential Address</label>&nbsp;&nbsp;&nbsp;
                                               
                                                <input type="text" class="form-control" name="preaddress">
                                               
                                            </div>
                                        </div> -->
                                    </div>
                                    <!-- dannel Modify End-->
                                    <div class="row">
	                                    <div style="padding-left: 16px;padding-right: 8px; width: 70%">
	                                    	<input class="form-control" type="text" name="preaddress" value="">
	                                    </div>
	                                    <div style="width: 15%; padding-left: 2px;padding-right: 8px;">
	                                     	<input type="text" class="form-control" name="p_time_stayed_years" id="p_time_stayed_years" value="${(client.p_time_stayed_years)!}">
	                                    </div>
	                                    <div style="width: 15%; padding-left: 2px;padding-right: 16px;">
	                                     	<input type="text" class="form-control" name="p_time_stayed_months" id="p_time_stayed_months" value="${(client.p_time_stayed_months)!}">
	                                    </div>
	                                    
                                        <!-- <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Time Stayed:(Address client are currently residing)</label>
                                                <div class="row">
	                                                <div class="col">
			                                            <div class="form-group">
			                                                <label>Year(s)</label>
			                                                <input type="text" class="form-control" name="p_time_stayed_years" id="p_time_stayed_years" value="${(client.p_time_stayed_years)!}">
			                                            </div>
				                                     </div>
			                                        <div class="col">
			                                            <div class="form-group">
			                                                <label>Month(s)</label>
			                                                <input type="text" class="form-control" name="p_time_stayed_months" id="p_time_stayed_months" value="${(client.p_time_stayed_months)!}">
			                                            </div>
			                                        </div>
                                                </div>
                                             </div>
                                        </div> -->
                                    </div>
                                    <br>
                                    </div>
                                            
	                                                	
	                                                </div>
                                                </div>
                                                <div style="text-align: center; border: solid 1px; height: 40px; border-radius:15px;">
                                                	<div id="add_pre_address" style="padding-top: 7px;">
                                                		<i class="material-icons">add_circle_outline</i>
                                       					<label for="fname">Add Previous Residential Address</label>
                                                	</div>
                                           		</div>
                                    <div class="row">
	                                    <div style="width: 70%; padding-left: 16px;padding-right: 8px;">
	                                    	<div class="form-group">
                                                <label for="fname">Postal Address (If different from residential address)</label>
                                                <input style="height: calc(2.40625rem + 2px);" class="form-control" id="postal_address" value="${(client.postal_address)!}">
                                            </div>
	                                    </div>
	                                    <div style="width: 30%; padding-left: 2px;padding-right: 16px;">
	                                    <div class="form-group">
                                                <label for="fname">Current Living Situation</label>
                                                <select id="current_living_situation" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
		                                            <option value="0">
		                                                Renting
		                                            </option>
		                                            <option value="1">
		                                                Living in own home
		                                            </option>
		                                            <option value="2">
		                                                Boarding
		                                            </option>
		                                            <option value="3">
		                                                Other
		                                            </option>
                                        		</select>
                                            </div>
	                                    </div>
                                        <!-- <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Postal Address (If different from residential address)</label>
                                                <input type="text" class="form-control" id="postal_address" value="${(client.postal_address)!}">
                                            </div>
                                        </div> -->
                                    </div>
                                    
                                    <!-- <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Current Living Situation</label>
                                                <select id="current_living_situation" data-toggle="select" data-minimum-results-for-search="-1" class="form-control">
		                                            <option value="0">
		                                                Renting
		                                            </option>
		                                            <option value="1">
		                                                Living in own home
		                                            </option>
		                                            <option value="2">
		                                                Boarding
		                                            </option>
		                                            <option value="3">
		                                                Other
		                                            </option>
                                        		</select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                
                                           </div>
                                        </div>
                                    </div> -->
                                    
                                </div>
                            </div>
                        </div>
                        </#if>
                        <!-- dannel Modify End-->
                        <div class="card card-form">
                        <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px;background-color: #C0C0C0;">
                                    <p><strong class="headings-color">Employment</strong></p>
                                    <!-- <p class="text-muted">Edit the client detailed employment information.</p> -->
                                </div>
                            <div class="row no-gutters">
                                
                                <div class="col-lg-12 card-form__body card-body">
                                 	<div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Source of Income </label>
                                                <select id="source_of_income" data-toggle="select" multiple data-minimum-results-for-search="-1" class="form-control">
		                                            <option value="Salary/Wage">
		                                                Salary/Wage
		                                            </option>
		                                            <option value="Self-employed">
		                                                Self-employed
		                                            </option>
		                                        </select>
                                        	</div>
                                        </div>
                                        
                                        
                                    </div>
                                    
                                   <div id="CE">
	                                	<div id="curemploy">
	                                	<div id="curemploy_[curemploy_index]">
                                    
                                    <div class="row">
                                    <div class="col">
                                            <div class="card-header bg-white d-flex align-items-center" style="padding-bottom: 1px;">
				                               <p><strong class="headings-color">Current Employment</strong></p>
				                                <div class="d-flex ml-auto">
				                                    <div style="display:none" onclick="RemoveCurEmploy('[curemploy_index]')" id="removeCurEmploy">
				                                                <i class="material-icons">remove_circle_outline</i>
				                                           		<label>Remove</label>
				                                           		</div>
				                                </div>
				                            </div>
                                    </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label>Current Employer</label>
                                                <input type="text" name="curcompany" class="form-control" id="company" value="">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label>Job title</label>
                                                <input type="text" class="form-control" name="curoccupation" id="occupation" value="">
                                            </div>
	                                     </div>
                                        
	                                     
                                    </div>
                                    
                                    
                                    <div class="row">
                                    	
	                                     
                                       <div class="col">
                                            <div class="form-group">
                                                <label>Length of time with this employer</label>
                                                <input type="text" class="form-control" name="curduration" id="duration" value="">
                                            </div>
	                                     </div>
	                                     <div class="col">
                                            <div class="form-group">
                                                <label>Gross Income</label>
                                                <input type="text" class="form-control" name="gross_income" id="gross_income" value="">
                                            </div>
                                        </div>
                                      
                                    </div>
                                    
                                    		
                                           		
                                    </div>
                                    </div>
                                        
	                                     
                                    </div>
                                    <div style="text-align: center; border: solid 1px; height: 40px; border-radius:15px;">
                                    <div id="add_curemploy" style="padding-top: 7px;">
                                                <i class="material-icons">add_circle_outline</i>
                                           		<label for="fname">Add Current Employment</label>
                                           		</div>
                                           		</div>
                                    
                                    
                                                <label for="fname">Previous Employment (If you were employed for less than 3 years at your current company)</label>
                                               <div id="previous_employment">
                                               	<div id="employ">
                                               		
	                                               <div id="employ_[employ_index]">
			                                               <div class="row">
		                                    <div class="col">
		                                            <div class="card-header bg-white d-flex align-items-center" style="padding-bottom: 1px;">
						                               <p><strong class="headings-color">Previous Employment</strong></p>
						                                <div class="d-flex ml-auto">
						                                    <div style="display:none" onclick="RemoveEmploy('[employ_index]')" id="removeEmploy">
						                                                <i class="material-icons">remove_circle_outline</i>
						                                           		<label>Remove</label>
						                                           		</div>
						                                </div>
						                            </div>
				                                    </div>
				                                    </div>
				                                    <div class="row">
				                                       <div class="col">
				                                            <div class="form-group">
				                                                <label>Previous Employer</label>
				                                                <input type="text" class="form-control" name="p_company_name" value="">
				                                            </div>
					                                     </div>
					                                     </div>
					                                      <div class="row">
					                                      <div class="col">
				                                            <div class="form-group">
				                                                <label>Job title</label>
				                                                <input type="text" class="form-control" name="p_job_title" value="">
				                                            </div>
				                                        </div>
				                                        <div class="col">
				                                            <div class="form-group">
				                                                <label>Length of time with this employer</label>
				                                                <input type="text" class="form-control" name="p_time_stayed" value="">
				                                            </div>
				                                        </div>
				                                        <!-- div class="d-flex ml-auto">
				                                        	<div class="form-group">
				                                        	<label></label>
				                                    			<div style="display:none" onclick="RemoveEmploy('[employ_index]')" id="removeEmploy">
				                                                <i class="material-icons">remove_circle_outline</i>
				                                           		
				                                           		</div>
				                                           		</div>
				                                		</div-->
				                                    </div>
				                                    </div>
				                                    </div>
			                                    </div>
			                                    <div style="text-align: center; border: solid 1px; height: 40px; border-radius:15px;">
			                                    
				                                   <div id="addnew" style="padding-top: 7px;">
	                                                <i class="material-icons">add_circle_outline</i>
	                                           		<label for="fname">Add Previous Employment</label>
	                                           		</div>
                                           		</div>
                                    
                                    
                                    
                                </div>
                            </div>
                        </div>
                        <#if type!=2>
                        <div class="card card-form">
                        <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px; background-color: #C0C0C0;">
                                    <p><strong class="headings-color">Property</strong></p>
                                    <!-- <p class="text-muted">Edit the client detailed property information.</p> -->
                                </div>
                            <div class="row no-gutters">
                                
                                <div class="col-lg-12 card-form__body card-body">
                                	<div id="security">
	                                	<div id="property">
	                                	<div id="property_[property_index]">
	                                		<div class="card-header bg-white d-flex align-items-center" style="padding-bottom: 1px;">
				                               <p><strong class="headings-color">Property Information</strong></p>
				                                <div class="d-flex ml-auto">
				                                    <div style="display:none" onclick="RemoveProperty('[property_index]')" id="removeProperty">
				                                                <i class="material-icons">remove_circle_outline</i>
				                                           		<label>Remove</label>
				                                           		</div>
				                                </div>
				                            </div>
		                                 	<div class="row">
		                                        <div class="col">
		                                            <div class="form-group">
		                                                <label for="fname">Property Address</label>
		                                                <input type="text" class="form-control" name="security_property">
		                                        	</div>
		                                        </div>
		                                        
		                                    </div>
		                                    <div class="row">
		                                       <div class="col">
		                                            <div class="form-group">
		                                                <label>Bank</label>
		                                                <input type="text" class="form-control" name="security_bank" value="">
		                                            </div>
			                                     </div>
		                                        <div class="col">
		                                            <div class="form-group">
		                                                <label>Owner</label>
		                                                <input type="text" class="form-control" name="security_owner" value="">
		                                            </div>
		                                        </div>
		                                    </div>
		                                    <div class="row">
		                                       <div class="col">
		                                            <div class="form-group">
		                                                <label>Property Type</label>
		                                                <input type="text" class="form-control" name="security_property_type" value="">
		                                            </div>
			                                     </div>
		                                        <div class="col">
		                                            <div class="form-group">
		                                                <label>Use</label>
		                                                <input type="text" class="form-control" name="security_property_use" value="">
		                                            </div>
		                                        </div>
		                                        <div class="col">
		                                            <div class="form-group">
		                                                <label>Value</label>
		                                                <input type="text" class="form-control" name="security_property_value" value="">
		                                            </div>
		                                        </div>
		                                    </div>
	                                    </div>
                                    </div>
                                    </div>
                                   
                                    
                                   
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group" style="text-align: center; border: solid 1px; height: 40px; border-radius:15px;">
			                                   <div id="addproperty" style="padding-top: 7px;">
                                                <i class="material-icons">add_circle_outline</i>
                                           		<label for="fname">Add More Property</label>
                                           		</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    
                                    
                                </div>
                            </div>
                        </div>
                        </#if>
                        <#if type!=2>
                        <div class="card card-form">
                        <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px; background-color: #C0C0C0;">
                                    <p><strong class="headings-color">Loan Structure</strong></p>
                                    <!-- <p class="text-muted">Edit the loan information.</p> -->
                                    
                                </div>
                            <div class="row no-gutters">
          
                                <div class="col-lg-12 card-form__body card-body">
                                <div id="loans">
	                                	<div id="loan">
	                                	<div id="loan_[node_index]">
	                                	<div class="card-header bg-white d-flex align-items-center" style="padding-bottom: 1px;">
                               <p><strong class="headings-color">Loan Information</strong></p>
                                <div class="d-flex ml-auto">
                                    <div style="display:none" onclick="Remove('[node_index]')" id="removeloan">
                                                <i class="material-icons">remove_circle_outline</i>
                                           		<label>Remove</label>
                                           		</div>
                                </div>
                            </div>
                                	<div class="row">
                                    	<div class="col">
                                            <div class="form-group">
                                                <label for="lname">Bank</label>
                                                <input type="text" class="form-control" name="loan_bank" value="">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Customer NO.</label>
                                                <input type="text" class="form-control" name="loan_customer_no" value="">
                                            </div>
                                        </div>
                                    </div>
                                 	<div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Borrowing Entity</label>
                                                <input type="text" class="form-control" name="loan_borrowing_entity" value="">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Loan Amount</label>
                                                <input type="text" class="form-control" name="loan_amount" value="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                    	<div class="col">
                                            <div class="form-group">
                                                <label for="fname">Loan Account NO.</label>
                                                <input type="text" class="form-control" name="loan_account_no" value="" >
                                            </div>
                                        </div>
                                        <div class="col">
                                             <div class="form-group">
		                                        <label for="loan_effective_date">Effective Date</label>
		                                        <input id="loan_effective_date_0" onblur="CalReview('[node_index]')" name="loan_effective_date" type="date" class="form-control" value="" placeholder="date: 00/00/0000"  maxlength="10">
		                                    </div>
                                        </div>
                                    </div>
                                   <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="fname">Now Rate Period</label>
                                                <select id="loan_now_rate_period_0" onchange="CalReview('[node_index]')" name="loan_now_rate_period"  class="form-control">
		                                            <option value="6">
		                                                6 months
		                                            </option>
		                                            <option value="12">
		                                                1 year
		                                            </option>
		                                            <option value="18">
		                                                18 months
		                                            </option>
		                                            <option value="24">
		                                                2 years
		                                            </option>
		                                            <option value="36">
		                                                3 years
		                                            </option>
		                                            <option value="48">
		                                                4 years
		                                            </option>
		                                            <option value="60">
		                                                5 years
		                                            </option>
		                                        </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Review Date</label>
                                                <input id="loan_review_date_0" name="loan_review_date" type="date" class="form-control" value="" placeholder="date: 00/00/0000" maxlength="10">
		                                    
                                            </div>
                                        </div>
                                    </div>
                                   <div class="row">
                                   		<div class="col">
                                            <div class="form-group">
                                                <label for="loan_interest_rate">Reminder Date</label>
                                                <select name="loan_reminder_days" class="form-control">
                                                	<option value="60">
		                                                2 months before Review Date
		                                            </option>
		                                            <option value="30">
		                                                1 months before Review Date
		                                            </option>
		                                            <option value="21">
		                                                3 weeks before Review Date
		                                            </option>
		                                            <option value="14">
		                                                2 weeks before Review Date
		                                            </option>
		                                            <option value="7">
		                                                1 week before Review Date
		                                            </option>
		                                        </select>
                                            </div>
                                        </div>
                                    	<div class="col">
                                            <div class="form-group">
                                                <label for="loan_interest_rate">Interest Rate</label>
                                                <input type="text" class="form-control" name="loan_interest_rate" value="" >
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                            <input type="hidden" class="form-control" name="task_id" value="0" >
                                                <label for="fname">Notes</label><br/>
                                                <textarea class="comment" name="loan_notes" rows="3" cols="60"></textarea>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    
                                </div>
                                </div>
                            </div>
                            <div class="row">
                                        <div class="col">
                                            <div class="form-group" style="text-align: center; border: solid 1px; height: 40px; border-radius:15px;">
			                                   <div id="addloan" style="padding-top: 7px;">
                                                <i class="material-icons">add_circle_outline</i>
                                           		<label>Add More Loan Structure</label>
                                           		</div>
                                            </div>
                                            
                                            
                                        </div>
                                    </div>
                            </div>
                            </div>
                        </div>
                        </#if>
                        <#if type!=2>
                        <div class="card card-form">
                        <div class="col-lg-12 card-body" style="padding-bottom: 10px;font-size: 30px; background-color: #C0C0C0;">
                                    <p><strong class="headings-color">Notes</strong></p>
                                </div>
                            <div class="row no-gutters">
                                
                                <div class="col-lg-12 card-form__body card-body">
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label for="lname">Description</label>
                                                <textarea class="comment" id="description" name="description" rows="3" cols="60">${(client.description)!}</textarea>
                                            </div>
                                        </div>
                                        
                                    </div>

                                </div>
                                
                                
                            </div>
                        </div>
                        </#if>

                        
                        <div class="text-right mb-5">
                        	<input type="hidden" id="clientid" value="${(client.id)!}">
                        	<input type="hidden" id="oldtasks" value="">
                        	<input type="hidden" id="type" value="${(type)!}">
                        	<input type="hidden" id="iframe" value="${(iframe)!}">
                        	<input type="hidden" id="tb" value="${(tb)!}">
                        	<input type="hidden" id="ilay" value="${(ilay)!}">
                        	 <input type="hidden" id="avatar_url" value="${(client.avatar)!}">
                        	 <#if type==2>
                        	 <button class="btn btn-success" onClick="return SaveClient('${method}');">Save Applicant</button>
                        	 <#else>
                        	 <button class="btn btn-success" onClick="return SaveClient('${method}');">Save Client</button>
                        	 &nbsp;
                        	 <button onclick="history.go(-1)" class="btn btn-success">Go Back</button>
                        	 </#if>
                            
                        </div>
                    </div>


                </div>
                <!-- // END drawer-layout__content -->
                <script>
                //dannel modify
                $("[name='gross_income']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                $("[name='security_property_value']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                $("[name='loan_amount']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                var client_avatar = '${(client.avatar)!}';
                function Remove(id){
                	$('#loan_'+id).remove();
                }
                function RemoveEmploy(id){
                	$('#employ_'+id).remove();
                }
                function RemoveCurEmploy(id){
                	$('#curemploy_'+id).remove();
                }
                function RemoveProperty(id){
                	$('#property_'+id).remove();
                }
                function RemoveMobile(id){
                	$('#divmobile_'+id).remove();
                }
                function RemoveEmail(id){
                	$('#divemail_'+id).remove();
                }
                function RemoveAddress(id){
                	$('#divaddress_'+id).remove();
                }
                //dannel modify
                function RemovePreAddress(id){
                	$('#divpreaddress_'+id).remove();
                }
                function d2sd(effective_date,months){
                	//moment.locale('en-NZ'); 
                	return moment(effective_date, "DD/MM/YYYY").add(months, 'months').format('YYYY-MM-DD');
                }
                String.prototype.replaceAll = function(search, replacement) {
            	    var target = this;
            	    return target.split(search).join(replacement);
            	};
                function parseDom(arg) {

                	var objE = document.createElement("div");

                	objE.innerHTML = "<div>"+arg+"</div>";

                	return objE.childNodes;

                }
function CalReview(node_index){
	
	if(node_index=='[node_index]'){
		var effective_date = formatDate($('#loan_effective_date_0').val());
/* 		alert(effective_date) */
		if(effective_date!=''){
			var months = $('#loan_now_rate_period_0').val();
			/* alert(d2sd(effective_date,months)) */
			$('#loan_review_date_0').val(d2sd(effective_date,months));
		}
		else{
			$('#loan_review_date_0').val('');
		}
	}
	else{
		var effective_date = formatDate($('#loan_effective_date_'+node_index).val());
		if(effective_date!=''){
			var months = $('#loan_now_rate_period_'+node_index).val();
			$('#loan_review_date_'+node_index).val(d2sd(effective_date,months));
		}
		else{
			$('#loan_review_date_'+node_index).val('');
		}
	}
		
}
                $(function () { 
                	function copyNode(nodeid){
                		var node_index = document.getElementsByName("loan_effective_date").length;
                		var property_index = document.getElementsByName("security_property").length;
                		var curemploy_index = document.getElementsByName("curcompany").length;
                		var employ_index = document.getElementsByName("p_company_name").length;
                		
                		var mobile_index = document.getElementsByName("mobile").length;
                		var email_index = document.getElementsByName("email").length;
                		var address_index = document.getElementsByName("address").length;
                		var pre_address_index = document.getElementsByName("preaddress").length;//dannel modify
                		var sourceNode = document.getElementById(nodeid); //  
                		var clonedNode = sourceNode.cloneNode(true); //  
                		//console.log(sourceNode.innerHTML)
                		//console.log('--------------------')
                		$node = $(clonedNode);
                		$node.find('button[id="bt_mobile"]').css("display","block");
                		$node.find('div[id="divmobile"]').attr("id","divmobile_"+mobile_index);
                		$node.find('button[id="bt_email"]').css("display","block");
                		$node.find('div[id="divemail"]').attr("id","divemail_"+email_index);
                		$node.find('button[id="bt_address"]').css("display","block");
                		$node.find('div[id="divaddress"]').attr("id","divaddress_"+address_index);
                		$node.find('div[id="bt_pre_address"]').css("display","block");//dannel modify
                		$node.find('div[id="divpreaddress"]').attr("id","divpreaddress_"+pre_address_index);
                		$node.find('div[id="removeloan"]').css("display","block");
                		$node.find('div[id="removeProperty"]').css("display","block");
                		$node.find('div[id="removeEmploy"]').css("display","block");
                		$node.find('div[id="removeCurEmploy"]').css("display","block");
                		$node.find('input[name="loan_effective_date"]').attr("id","loan_effective_date_"+node_index);
                		$node.find('select[name="loan_now_rate_period"]').attr("id","loan_now_rate_period_"+node_index);
                		$node.find('input[name="loan_review_date"]').attr("id","loan_review_date_"+node_index);
                		$node.find('input[name="task_id"]').val(0);
                		var html = $node.html().replaceAll('[node_index]',node_index);  
                		html = html.replaceAll('[property_index]',property_index);  
                		html = html.replaceAll('[curemploy_index]',curemploy_index);  
                		html = html.replaceAll('[employ_index]',employ_index);  
                		html = html.replaceAll('[mobile_index]',mobile_index);  
                		html = html.replaceAll('[email_index]',email_index); 
                		html = html.replaceAll('[address_index]',address_index); 
                		html = html.replaceAll('[pre_address_index]',pre_address_index); //dannel modify
                		//console.log(html)
                		var newnode = parseDom(html);
                		sourceNode.parentNode.appendChild($(newnode)[0]); //  
                	}
                	$("#edit_avatar").on('click',function(e){
                		var url = '/add_avatar3?url='+client_avatar;
                		layer.open({
                			type: 2,
                			title: 'Edit client avatar',
                			fixed: false, //
                			maxmin: true,
                		    shadeClose: true, //
                			area: ['60%', '85%'],
                			content: url ,
                			success:function(layero,index){
                	        },
                	        end:function(){
                	        	document.getElementById('iframe_avatar').contentWindow.document.getElementById('profile-pic').src=$('#avatar_url').val();
                	        	//alert($('#avatar_url').val());
                	        }
                		});
                	});
                	$("#add_mobile").on('click',function(e){
                		//$('#mobiles').append($('#inputmobile').html());
                		copyNode("inputmobile");
                	});
                	$("#add_email").on('click',function(e){
                		copyNode("inputemail");
                	});
                	$("#add_address").on('click',function(e){
                		copyNode("inputaddress");
                	});
                	//dannel modify
                	$("#add_pre_address").on('click',function(e){
                		copyNode("inputpreaddress");
                	});
                	$("#addloan").on('click',function(e){
                		copyNode("loan");
                		$("[name='loan_amount']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                	});
                	
                	$("#add_curemploy").on('click',function(e){
                		copyNode("curemploy");
                		$("[name='gross_income']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                	});
                	$("#addnew").on('click',function(e){
                		copyNode("employ");
                	});
                	$("#addproperty").on('click',function(e){
                		copyNode("property");
                		$("[name='security_property_value']").maskMoney({prefix:'$', allowNegative: true, thousands:',', decimal:'.', affixesStay: true});
                	});
                	
                	if('${method}'=='edit'){
                		var type= '${(type)!}';
	                	var gender = '${(client.gender)!}';
	                	$('#gender').val(gender).trigger('change');
	                	var title = '${(client.title)!}';
	                	$('#title').val(title).trigger('change');
	                	var residency_nz = '${(client.residency_nz)!}';
	                	$('#residency_nz').val(residency_nz).trigger('change');
	                	var marital_status = '${(client.marital_status)!}';
	                	$('#marital_status').val(marital_status).trigger('change');
	                	var current_living_situation = '${(client.current_living_situation)!}';
	                	$('#current_living_situation').val(current_living_situation).trigger('change');
	                	
	                	var source_of_income = JSON.parse('${(client.source_of_income)!}');
	                	$("#source_of_income").val(source_of_income).trigger('change');
	                	if(type==2){
	                		var ages = '${(client.dependants_age)!}';
		                	if(ages!=''){
			                	var ageArray = JSON.parse(ages);
			                	var names = document.getElementsByName("dependants_age");
			                	//alert(names.length)
			    				for(var i=0;i<ageArray.length;i++){
			    					names[i].value=ageArray[i];
			    				} 
			                	
		                	} 
	                	}
	                	
	                	
	                	var mobiles = '${(client.mobile)!}';
	                	if(mobiles!=''){
		                	var mobileArray = JSON.parse(mobiles);
		                	for(var i=1;i<mobileArray.length;i++){
		                		copyNode("inputmobile");
		                	}
		                	var mobile = document.getElementsByName("mobile");
		    				for(var i=0;i<mobileArray.length;i++){
		    					mobile[i].value=mobileArray[i];
		    				}  
	                	} 
	                	
	                	var emails = '${(client.personal_email)!}';
	                	if(emails!=''){
		                	var emailArray = JSON.parse(emails);
		                	for(var i=1;i<emailArray.length;i++){
		                		copyNode("inputemail");
		                	}
		                	var email = document.getElementsByName("email");
		    				for(var i=0;i<emailArray.length;i++){
		    					email[i].value=emailArray[i];
		    				}  
	                	} 
	                	var addresses = '${(client.address)!}';
	                	if(addresses!=''){
		                	var addressArray = JSON.parse(addresses);
		                	for(var i=1;i<addressArray.length;i++){
		                		copyNode("inputaddress");
		                	}
		                	var address = document.getElementsByName("address");
		    				for(var i=0;i<addressArray.length;i++){
		    					address[i].value=addressArray[i];
		    				}  
	                	} 
	                	//dannel modify
	                	if(type==2){
	                		var preaddresses = '${(client.previous_residential_address)!}';
		                	if(preaddresses!=''){
			                	var preaddressArray = JSON.parse(preaddresses);
			                	for(var i=1;i<preaddressArray.length;i++){
			                		copyNode("inputpreaddress");
			                	}
			                	var preaddress = document.getElementsByName("preaddress");
			                	var p_time_stayed_years = document.getElementsByName("p_time_stayed_years");
			    				var p_time_stayed_months = document.getElementsByName("p_time_stayed_months");
			    				for(var i=0;i<preaddressArray.length;i++){
			    					preaddress[i].value=preaddressArray[i]['preaddress'];
			    					p_time_stayed_years[i].value=preaddressArray[i]['p_time_stayed_years'];
			    					p_time_stayed_months[i].value=preaddressArray[i]['p_time_stayed_months'];
			    				}  
		                	} 
	                	}
	                	
	                	
	                	var curemployment = '${(client.current_employment)!}';
	                	if(curemployment!=''){
		                	var curemploymentArray = JSON.parse(curemployment);
		                	for(var i=1;i<curemploymentArray.length;i++){
		                		copyNode("curemploy");
		                	}
		                	var curcompany = document.getElementsByName("curcompany");
		    				var curoccupation = document.getElementsByName("curoccupation");
		    				var curduration = document.getElementsByName("curduration");
		    				var gross_income = document.getElementsByName("gross_income");
		    				for(var i=0;i<curemploymentArray.length;i++){
		    					curcompany[i].value=curemploymentArray[i]['curcompany'];
		    					curoccupation[i].value=curemploymentArray[i]['curoccupation'];
		    					curduration[i].value=curemploymentArray[i]['curduration'];
		    					gross_income[i].value=curemploymentArray[i]['gross_income'];
		    				}  
	                	} 
	                	
	                	var employment = '${(client.previous_employment)!}';
	                	if(employment!=''){
		                	var employmentArray = JSON.parse(employment);
		                	for(var i=1;i<employmentArray.length;i++){
		                		copyNode("employ");
		                	}
		                	var p_company_name = document.getElementsByName("p_company_name");
		    				var p_time_stayed = document.getElementsByName("p_time_stayed");
		    				var p_job_title = document.getElementsByName("p_job_title");
		    				for(var i=0;i<employmentArray.length;i++){
		    					p_company_name[i].value=employmentArray[i]['company_name'];
		    					p_time_stayed[i].value=employmentArray[i]['time_stayed'];
		    					p_job_title[i].value=employmentArray[i]['job_title'];
		    				}  
	                	} 
	                	
	                	var property = '${(client.property)!}';
	                	if(property!=''){
		                	var propertyArray = JSON.parse(property);
		                	for(var i=1;i<propertyArray.length;i++){
		                		copyNode("property");
		                	}
		                	var security_property = document.getElementsByName("security_property");
		                	var security_bank = document.getElementsByName("security_bank");
		                	var security_owner = document.getElementsByName("security_owner");
		    				var security_property_type = document.getElementsByName("security_property_type");
		    				var security_property_use = document.getElementsByName("security_property_use");
		    				var security_property_value = document.getElementsByName("security_property_value");
		    				for(var i=0;i<propertyArray.length;i++){
		    					security_property[i].value=propertyArray[i]['property'];
		    					security_bank[i].value=propertyArray[i]['bank'];
		    					security_owner[i].value=propertyArray[i]['owner'];
		    					security_property_type[i].value=propertyArray[i]['property_type'];
		    					security_property_use[i].value=propertyArray[i]['use'];
		    					security_property_value[i].value=propertyArray[i]['value'];
		    				}  
	                	} 
	                	
	                	var loan = '${(client.loan)!}';
	                	var oldTaskIdsArr = new Array();
	                	if(loan!=''){
		                	var loanArray = JSON.parse(loan);
		                	for(var i=1;i<loanArray.length;i++){
		                		copyNode("loan");
		                	}
		                	var loan_bank = document.getElementsByName("loan_bank");
		    				var loan_customer_no = document.getElementsByName("loan_customer_no");
		    				var loan_borrowing_entity = document.getElementsByName("loan_borrowing_entity");
		    				var loan_amount = document.getElementsByName("loan_amount");
		    				var loan_account_no = document.getElementsByName("loan_account_no");
		    				var loan_effective_date = document.getElementsByName("loan_effective_date");
		    				var loan_now_rate_period = document.getElementsByName("loan_now_rate_period");
		    				var loan_review_date = document.getElementsByName("loan_review_date");
		    				var loan_reminder_days = document.getElementsByName("loan_reminder_days");
		    				var loan_interest_rate = document.getElementsByName("loan_interest_rate");
		    				var loan_notes = document.getElementsByName("loan_notes");
		    				var task_id = document.getElementsByName("task_id");
		    				for(var i=0;i<loanArray.length;i++){
		    					loan_bank[i].value=loanArray[i]['loan_bank'];
		    					loan_customer_no[i].value=loanArray[i]['loan_customer_no'];
		    					loan_borrowing_entity[i].value=loanArray[i]['loan_borrowing_entity'];
		    					loan_amount[i].value=loanArray[i]['loan_amount'];
		    					loan_account_no[i].value=loanArray[i]['loan_account_no'];
		    					loan_effective_date[i].value=loanArray[i]['loan_effective_date'];
		    					loan_now_rate_period[i].value=loanArray[i]['loan_now_rate_period'];
		    					loan_review_date[i].value=loanArray[i]['loan_review_date'];
		    					loan_reminder_days[i].value=loanArray[i]['loan_reminder_days'];
		    					loan_interest_rate[i].value=loanArray[i]['loan_interest_rate'];
		    					loan_notes[i].value=loanArray[i]['loan_notes'];
		    					task_id[i].value=loanArray[i]['task_id'];
		    					oldTaskIdsArr.push(loanArray[i]['task_id']);
		    				}  
		    				if(oldTaskIdsArr.length>0)
		                		$('#oldtasks').val(String(oldTaskIdsArr));
	                	} 
                	}
                })
                //jQuery(function($){
                	
                //});
                function formatDate(date) {
                    var d = new Date(date),
                        month = '' + (d.getMonth() + 1),
                        day = '' + d.getDate(),
                        year = d.getFullYear();

                    if (month.length < 2) 
                        month = '0' + month;
                    if (day.length < 2) 
                        day = '0' + day;

                    return [day, month, year].join('/');
                }
function SaveClient(method){
				var title=$('#title').val();
				var gender=$('#gender').val();
				var first_name=$('#first_name').val();
				var last_name=$('#last_name').val();
				var prefered_name=$('#prefered_name').val();
				var birthday = formatDate($('#birthday').val());
				var work_phone=$('#work_phone').val();
				var description=$('#description').val();
				var mobileArr=[];
		        $("input[name='mobile']").each(function(){
		        	mobileArr.push($(this).val());
		        })
		        var mobile = JSON.stringify(mobileArr);
		        
		        var emailArr=[];
		        $("input[name='email']").each(function(){
		        	emailArr.push($(this).val());
		        })
		        var email = JSON.stringify(emailArr);
		        
		        var addressArr=[];
		        $("input[name='address']").each(function(){
		        	addressArr.push($(this).val());
		        })
		        var address = JSON.stringify(addressArr);
		        
		      
		        
				var home_phone=$('#home_phone').val();
				var wechat=$('#wechat').val();
				
				var work_email=$('#work_email').val();
				var comments=$('#comments').val();
				var clientid=$('#clientid').val();
				var oldtasks=$('#oldtasks').val();
				//var avatar=document.getElementById('iframe_avatar').contentWindow.document.getElementById('avatar_url').value;
				var avatar = $('#avatar_url').val();
				var type=$('#type').val();
				var ilay=$('#ilay').val();
				var iframe=$('#iframe').val();
				var tb=$('#tb').val();
				var url = "/client/";
				if(method=='add')url+="save";
				else url+="update";
				
				//var dependants_age = $('#dependants_age').val();
				var ageArray = new Array();
				var names = document.getElementsByName("dependants_age");
				
				for(var i=0;i<names.length;i++){
				//alert(names[i].value); //
					if(names[i].value!='')
						ageArray.push(names[i].value);
				} 
				
				var jsonStr = JSON.stringify( ageArray );
				//alert(jsonStr);
				
				
				
				var dependants_number=$('#dependants_number').val();
				var residency_nz=$('#residency_nz').val();
				var marital_status=$('#marital_status').val();
				var current_residential_address=$('#current_residential_address').val();
				var time_stayed_years=$('#time_stayed_years').val();
				var time_stayed_months=$('#time_stayed_months').val();
				var p_time_stayed_years=$('#p_time_stayed_years').val();
				var p_time_stayed_months=$('#p_time_stayed_months').val();
				
		        var preaddressArr=new Array();
				var preaddress = document.getElementsByName("preaddress");
				var p_time_stayed_years = document.getElementsByName("p_time_stayed_years");
				var p_time_stayed_months = document.getElementsByName("p_time_stayed_months");
				for(var i=0;i<preaddress.length;i++){
					if(preaddress[i].value!=''){
						preaddressArr.push({"preaddress":preaddress[i].value,
							"p_time_stayed_years":p_time_stayed_years[i].value
							,"p_time_stayed_months":p_time_stayed_months[i].value});
					}
				} 
				var jsonPreAddress = JSON.stringify( preaddressArr );
		        
				var postal_address=$('#postal_address').val();
				var current_living_situation=$('#current_living_situation').val();
				
				var source_of_income=JSON.stringify($('#source_of_income').val());
				
				var occupation=$('#occupation').val();
				var company=$('#company').val();
				var duration=$('#duration').val();
				var gross_income=$('#gross_income').val();
				/* alert(occupation)
				alert(company)
				alert(duration)*/
				//alert(gross_income) 
				var curemployArray = new Array();
				var curcompany = document.getElementsByName("curcompany");
				var curoccupation = document.getElementsByName("curoccupation");
				var curduration = document.getElementsByName("curduration");
				var curgross_income = document.getElementsByName("gross_income");
				for(var i=0;i<curcompany.length;i++){
					if(curcompany[i].value!=''){
						curemployArray.push({"curcompany":curcompany[i].value,
							"curoccupation":curoccupation[i].value,
							"curduration":curduration[i].value,
							"gross_income":curgross_income[i].value.replace(/\$|,/g, '')});
					}
				} 
				var jsonCurEmploy = JSON.stringify( curemployArray );
				
				var employArray = new Array();
				var p_company_name = document.getElementsByName("p_company_name");
				var p_time_stayed = document.getElementsByName("p_time_stayed");
				var p_job_title = document.getElementsByName("p_job_title");
				for(var i=0;i<p_company_name.length;i++){
					if(p_company_name[i].value!=''){
						employArray.push({"company_name":p_company_name[i].value,
							"time_stayed":p_time_stayed[i].value,
							"job_title":p_job_title[i].value});
					}
				} 
				//alert(employArray);
				var jsonEmploy = JSON.stringify( employArray );
				//alert(jsonEmploy);
				
				var propertyArray = new Array();
				var security_property = document.getElementsByName("security_property");
				var security_bank = document.getElementsByName("security_bank");
				var security_owner = document.getElementsByName("security_owner");
				var security_property_type = document.getElementsByName("security_property_type");
				var security_property_use = document.getElementsByName("security_property_use");
				var security_property_value = document.getElementsByName("security_property_value");
				for(var i=0;i<security_property.length;i++){
					if(security_property[i].value!=''){
						propertyArray.push({"property":security_property[i].value,"bank":security_bank[i].value,
							"owner":security_owner[i].value,"property_type":security_property_type[i].value,
							"use":security_property_use[i].value,"value":security_property_value[i].value.replace(/\$|,/g, '')});
					}
				} 
				var jsonProperty = JSON.stringify( propertyArray );
				
				
				var loanArray = new Array();
				var loan_bank = document.getElementsByName("loan_bank");
				var loan_customer_no = document.getElementsByName("loan_customer_no");
				var loan_borrowing_entity = document.getElementsByName("loan_borrowing_entity");
				var loan_amount = document.getElementsByName("loan_amount");
				var loan_account_no = document.getElementsByName("loan_account_no");
				var loan_effective_date = document.getElementsByName("loan_effective_date");
				var loan_now_rate_period = document.getElementsByName("loan_now_rate_period");
				var loan_review_date = document.getElementsByName("loan_review_date");
				var loan_reminder_days = document.getElementsByName("loan_reminder_days");
				var loan_interest_rate = document.getElementsByName("loan_interest_rate");
				var loan_notes = document.getElementsByName("loan_notes");
				var task_id = document.getElementsByName("task_id");
				var newtasks = new Array();
				for(var i=0;i<loan_bank.length;i++){
					if(loan_bank[i].value!=''){
						loanArray.push({"loan_bank":loan_bank[i].value,"loan_customer_no":loan_customer_no[i].value,
							"loan_borrowing_entity":loan_borrowing_entity[i].value,"loan_amount":loan_amount[i].value.replace(/\$|,/g, ''),
							"loan_account_no":loan_account_no[i].value,"loan_effective_date":formatDate(loan_effective_date[i].value),
							"loan_now_rate_period":loan_now_rate_period[i].value,"loan_review_date":formatDate(loan_review_date[i].value),
							"loan_reminder_days":loan_reminder_days[i].value,"loan_interest_rate":loan_interest_rate[i].value,
							"loan_notes":loan_notes[i].value,"task_id":task_id[i].value});
						newtasks.push(task_id[i].value);
					}
				} 
				var jsonLoan = JSON.stringify( loanArray );
				
				var oldstr = $('#oldtasks').val();
				var delset = new Set();
				if(oldstr!=''){
					var old = oldstr.split(",");
					var oldset = new Set(old);
	 				var newset = new Set(newtasks);
	 				
		
	 				for (var x of oldset) {
	 					if(newset.has(x)){
	 					}
	 					else{
	 						delset.add(x);
	 					}
	 				}
				}
 				var deltasks ='';
 				if(delset.size>0){
 					deltasks =  String(Array.from(delset));
 				}
				
				$.post(url, {"client.id":clientid,"client.avatar":avatar,"client.type":type,"client.title":title,"client.gender":gender,
					"client.first_name":first_name,"client.last_name":last_name,"client.prefered_name":prefered_name,
					"birthday":birthday,"client.work_phone":work_phone,
					"client.mobile":mobile,"client.address":address,
					"client.home_phone":home_phone,"client.wechat":wechat,
					"client.personal_email":email,"client.work_email":work_email,
					"client.comments":comments,"client.dependants_number":dependants_number,"client.dependants_age":jsonStr,
					"client.residency_nz":residency_nz,
					"client.marital_status":marital_status,"client.current_residential_address":current_residential_address,
					"client.time_stayed_years":time_stayed_years,"client.time_stayed_months":time_stayed_months,
					"client.previous_residential_address":jsonPreAddress,
					"client.postal_address":postal_address,"client.current_living_situation":current_living_situation,
					"client.source_of_income":source_of_income,
					"client.occupation":occupation,"client.company":company,
					"client.duration":duration,"client.gross_income":gross_income,
					"client.current_employment":jsonCurEmploy,
					"client.previous_employment":jsonEmploy,
					"client.property":jsonProperty,
					"client.description":description,
					"client.loan":jsonLoan,"oldtasks":oldtasks,"deltasks":deltasks}, function(data) {
					if(data.code==1){
					 	mlayer.open({
						    content: 'Fail',
						    btn: 'Got it'
						  });
						return false;
					}
					else{ 
						if(ilay==0){
							mlayer.open({
							    content: 'Success',
							    btn: 'Got it',
							    yes: function(){
							    	location.href="/client";
							      }
							  }); 
						}
						else{
							if(iframe==0){
								var a = parent.$("#app_ids").val();
								var b = new Array();
								b.push(data.id);
					 			if(a==''){
					 				//alert("b:"+String(b));
					 				var s = String(b);
					 				parent.$("#minus_ids").val(b);
					 				parent.$("#app_ids").val(s);
					 			}
					 			else{
					 				var union = a.split(",");
					 				var unionset = new Set(union);
					 				var addset = new Set(b);

					 				for (var x of addset) {
					 					if(unionset.has(x)){
					 						addset.delete(x);
					 					}
					 					else{
					 						unionset.add(x);
					 					}
					 				}

									let minus = Array.from(addset);
									union = Array.from(unionset);
						 				
					 				parent.$("#minus_ids").val(minus);
					 				parent.$("#app_ids").val(String(union));
					 			}
								
								
								
								
								
								
								
								
								var index = parent.layer.getFrameIndex(window.name);
								
					 	        parent.layer.close(index);
							}
							else if(iframe==1){
								mlayer.open({
								    content: 'Success',
								    btn: 'Got it',
								    yes: function(){
								    	mlayer.closeAll();
								    	parent.window.NewApplicantSucc(data.id,tb);
								    	
								      }
								  });
							}
						}
					}
					return false;
				}, "json"); 
				return false;
	

}
</script>
</@layout>